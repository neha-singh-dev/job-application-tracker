<!DOCTYPE html>
<html>
<head>
    <title>Job Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h1>Job Tracker</h1>
    <a class="btn-add" href="{{ url_for('add_job') }}">Add New Job</a>

    <!-- Search & Filter -->
    <form class="search-form" method="GET" action="{{ url_for('home') }}">
        <input type="text" name="search" placeholder="Search by company or role" value="{{ search }}">
        <select name="status_filter">
            <option value="">All Statuses</option>
            <option value="Applied" {% if status_filter=='Applied' %}selected{% endif %}>Applied</option>
            <option value="Interview" {% if status_filter=='Interview' %}selected{% endif %}>Interview</option>
            <option value="Rejected" {% if status_filter=='Rejected' %}selected{% endif %}>Rejected</option>
        </select>
        <button type="submit">Search/Filter</button>
    </form>

    <!-- Sort -->
    <form class="sort-form" method="GET" action="{{ url_for('home') }}">
        <input type="hidden" name="search" value="{{ search }}">
        <input type="hidden" name="status_filter" value="{{ status_filter }}">
        <label for="sort_by">Sort by:</label>
        <select name="sort_by" id="sort_by">
            <option value="">--Select--</option>
            <option value="company" {% if sort_by=='company' %}selected{% endif %}>Company</option>
            <option value="role" {% if sort_by=='role' %}selected{% endif %}>Role</option>
            <option value="status" {% if sort_by=='status' %}selected{% endif %}>Status</option>
        </select>
        <button type="submit">Sort</button>
    </form>

    <!-- Job List -->
    <ul class="job-list">
        {% if jobs|length == 0 %}
            <li class="no-jobs">No jobs found matching your search/filter.</li>
        {% else %}
            {% for job in jobs %}
                <li>
                    <span class="job-info">{{ job[1] }} - {{ job[2] }}</span> - 
                    <span class="
                        {% if job[3]|lower == 'applied' %}status-applied{% endif %}
                        {% if job[3]|lower == 'interview' %}status-interview{% endif %}
                        {% if job[3]|lower == 'rejected' %}status-rejected{% endif %}
                    ">{{ job[3] }}</span>

                    <div class="job-actions">
                        <a class="btn-edit" href="{{ url_for('update_job', id=job[0]) }}">Edit</a>
                        <form action="{{ url_for('delete_job', id=job[0]) }}" method="POST" style="display:inline;">
                            <button class="btn-delete" type="submit">Delete</button>
                        </form>
                    </div>
                </li>
            {% endfor %}
        {% endif %}
    </ul>

    <!-- Pagination -->
    <div class="pagination">
        {% if page > 1 %}
            <a href="?search={{ search }}&status_filter={{ status_filter }}&sort_by={{ sort_by }}&page={{ page-1 }}">Previous</a>
        {% endif %}

        Page {{ page }} of {{ total_pages }}

        {% if page < total_pages %}
            <a href="?search={{ search }}&status_filter={{ status_filter }}&sort_by={{ sort_by }}&page={{ page+1 }}">Next</a>
        {% endif %}
    </div>
</div>

<script>
    const deleteForms = document.querySelectorAll('form[action^="{{ url_for("delete_job", id=0)[:-1] }}"]');
    deleteForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            if (!confirm("Are you sure you want to delete this job?")) e.preventDefault();
        });
    });
</script>
</body>
</html>
